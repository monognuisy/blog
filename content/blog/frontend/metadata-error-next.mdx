---
title: ë©”íƒ€ë°ì´í„° ì ìš© ì•ˆë˜ëŠ” ë¬¸ì œ ë¶„ì„
date: '2025-06-04'
description: 'Next.js 15 ì—ì„œ ë©”íƒ€ë°ì´í„°ê°€ ì œëŒ€ë¡œ ì ìš©ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤. ì•„ë¬´ë˜ë„ 15.2 ì—ì„œ ì¶”ê°€ëœ streaming metadata ê°€ ì›ì¸ì¸ ê²ƒ ê°™ì€ë°, ì •í™•í•œ ì›ì¸ì„ ì°¾ì•„ë³´ê³ , ì‹¤ìˆ˜ë¡œë¼ë„ ë°œìƒí•˜ì§€ ì•Šë„ë¡ í•´ê²°í•´ë³´ì. ë˜í•œ, ì •í™•í•œ ì›ì¸ì„ ì•Œì•„ë³´ê¸° ìœ„í•´ ì½”ë“œë¥¼ ë¶„ì„í•´ë³´ì!'
tags: ['Web', 'Frontend', 'Next.js']
categories: 'Web'
cover: 'streaming-metadata'
---

<Note title="ì½ê¸° ì „ì—" variant="info">

next.js 15.3.3 ê¸°ì¤€, ì•„ì§ ì´ ë²„ê·¸ëŠ” í•´ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

canary ë¹Œë“œ (>= 15.3.1-canary.12) ì—ì„œëŠ” ë²„ê·¸ê°€ í•´ê²°ë˜ì—ˆìœ¼ë‹ˆ, ë™ì¼í•œ ë¬¸ì œë¥¼ ê²ªëŠ” ë¶„ì´ ìˆë‹¤ë©´ (**ìì‹ ì˜ ì½”ë“œì˜ ë¬¸ì œì ì„ ë¨¼ì € ê³ ì¹œ ë’¤!** ê·¸ë˜ë„ ë¬¸ì œê°€ ë°œìƒí•œë‹¤ë©´) ìµœì‹  canary ë¹Œë“œë¥¼ ì‚¬ìš©í•´ë³´ì„¸ìš”.

</Note>

<Note title="ì°¸ê³ " variant="note">
ì´ ê¸€ì€ ë¬¸ì œ ë°œìƒ ë°°ê²½, ë¬¸ì œ ì„¤ëª…, í•´ê²°, ì›ì¸ ë¶„ì„ì˜ ê³¼ì •ì„ ë‹´ì€ **ë‹¤ì†Œ ê¸´ ê¸€**ì…ë‹ˆë‹¤.

ë”°ë¼ì„œ, ë¬¸ì œ í•´ê²° ë°©ë²• ì´ë‚˜ êµ¬ì²´ì ì¸ ì›ì¸ ì„¤ëª…ìœ¼ë¡œ ë°”ë¡œ ê±´ë„ˆë›°ê³  ì‹¶ë‹¤ë©´, ë‹¤ìŒì„ ëˆ„ë¥´ì„¸ìš”.

- [ë¬¸ì œ í•´ê²° ë°©ë²•](#ë¬¸ì œ-í•´ê²°-ë°©ë²•)
- [ì›ì¸ ë¶„ì„](#ì›ì¸-ë¶„ì„)

</Note>

## ë°°ê²½) next.js 15, react 19ë¡œì˜ ì—…ê·¸ë ˆì´ë“œ

next.js 15 ì—ì„œ react 19 ë¥¼ ì™„ì „íˆ ì§€ì›í•œë‹¤ëŠ” ê²ƒì„ ì•Œì•˜ê³  ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì—ì„œ 15 ë²„ì „ìœ¼ë¡œ ê°œë°œí–ˆì„ ë•Œì˜ í° ë¶ˆí¸í•¨ì´ ì—†ì—ˆì–´ì„œ ì´ ë¸”ë¡œê·¸ë„ ìŠ¬ê¸ˆìŠ¬ê¸ˆ ë²„ì „ ì—… ê°ì„ ë³´ê³  ìˆì—ˆë‹¤. ë™ì‹œì— tailwindcss ë„ v3 ì—ì„œ v4 ë¡œ ì—…ê·¸ë ˆì´ë“œ í• ê¹Œ ìƒê°í–ˆì§€ë§Œ, ì™„ì „íˆ ë‹¬ë¼ì§„ config ë°©ë²•ìœ¼ë¡œ ì¸í•´ í•œ ë²ˆì— migrationí•˜ëŠ” ê²ƒì€ ì¡°ê¸ˆ ë³µì¡í•´ì§ˆ ê²ƒ ê°™ì•„ì„œ, ì¼ë‹¨ì€ next ë°‘ ë‹¤ë¥¸ íŒ¨í‚¤ì§€ë“¤ë§Œ ì—…ê·¸ë ˆì´ë“œ í•˜ê³ ì í•˜ì˜€ë‹¤.

í”„ë¡œì íŠ¸ëŠ” yarn ìœ¼ë¡œ íŒ¨í‚¤ì§€ë¥¼ ê´€ë¦¬í•˜ê³  ìˆì—ˆì–´ì„œ, ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ í†µí•´ ì¸í„°ë™í‹°ë¸Œ í•˜ê²Œ ì›í•˜ëŠ” íŒ¨í‚¤ì§€ë§Œ ì—…ê·¸ë ˆì´ë“œë¥¼ ì§„í–‰í•  ìˆ˜ ìˆì—ˆë‹¤.

```bash
yarn upgrade-interactive --latest
```

ê°„ë‹¨íˆ next config íŒŒì¼ì˜ í™•ì¥ìë¥¼ ts ë¡œ ë°”ê¾¸ê³ , eslint ì„¤ì • íŒŒì¼ì„ ì¬êµ¬ì„±í•˜ëŠ” ë“±ì˜ ê°„ë‹¨í•œ migration ê³¼ì •ì„ ê±°ì³¤ë‹¤. ë‚˜ì•„ê°€ params ë“±ì„ await í•´ì„œ ë°›ì•„ì˜¤ê²Œ ë°”ê¾¸ì—ˆë‹¤.

## ë¬¸ì œ ë°œìƒ: metadata ê°€ ì ìš©ë˜ì§€ ì•ŠìŒ

ê·¸ë ‡ê²Œ ì—…ê·¸ë ˆì´ë“œë¥¼ í•˜ê³  ë¸”ë¡œê·¸ë¥¼ ì‚´í´ë³´ë˜ ì¤‘, **open graph íƒœê·¸ê°€ ì œëŒ€ë¡œ ì ìš©ë˜ê³  ìˆì§€ ì•Šë‹¤**ëŠ” ê²ƒì„ ì•Œê²Œ ë˜ì—ˆë‹¤. ì‹¤ì œ ë°°í¬ëœ ë¸”ë¡œê·¸ì—ì„œ ê°œë°œì ë„êµ¬ë¡œ ìš”ì†Œ ê²€ì‚¬ í–ˆì„ë•ŒëŠ” ì œëŒ€ë¡œ `<head>` íƒœê·¸ ì•„ë˜ì— open graph ë©”íƒ€ íƒœê·¸ê°€ ìˆì—ˆì§€ë§Œ, ê·¸ê²ƒì„ ì œëŒ€ë¡œ ì™¸ë¶€ ê²€ì‚¬ íˆ´ë“¤ì´ í¬ë¡¤ë§í•˜ì§€ ëª»í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì˜€ë‹¤.

Open graph ë¿ë§Œ ì•„ë‹ˆë¼, title, description ê³¼ ê°™ì€ **ë©”íƒ€ë°ì´í„°ë„ ì œëŒ€ë¡œ ì ìš©ë˜ì§€ ì•Š**ê³  ìˆì—ˆë‹¤. ì´ëŠ” SEOì— í° ì•…ì˜í–¥ì„ ë¼ì¹  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë¸”ë¡œê·¸ë¡œì„œëŠ” ìƒë‹¹íˆ í° ë¬¸ì œì˜€ë‹¤.

ì°¸ê³ ë¡œ, ë©”íƒ€ë°ì´í„°ëŠ” ê³µì‹ ë¬¸ì„œë¥¼ ë”°ë¼ ë‹¤ìŒê³¼ ê°™ì´ app ì˜ ìµœìƒìœ„ `layout.tsx` ì— ì •ì˜í•˜ì˜€ë‹¤.

```tsx
export const metadata: Metadata = {
  metadataBase: new URL(
    isProduction ? process.env.NEXT_PUBLIC_URI! : 'http://localhost:3000',
  ),
  title: 'monognuisy blog',
  description: 'Technical blog about web development, programming, and more.',
  openGraph: {
    title: 'monognuisy blog',
    description: 'Technical blog about web development, programming, and more.',
    url: `${process.env.NEXT_PUBLIC_URI}`,
    siteName: 'monognuisy blog',
    locale: 'ko_KR',
    type: 'website',
    images: [
      {
        url: `/images/cover/blog-cover.webp`,
        width: 1200,
        height: 630,
        alt: 'monognuisy blog cover image',
      },
    ],
  },
  twitter: {
    card: 'summary_large_image',
    title: 'monognuisy blog',
    description: 'Technical blog about web development, programming, and more.',
    images: [`/images/cover/blog-cover.webp`],
  },
  verification: {
    google: `${process.env.NEXT_PUBLIC_GOOGLE_VERIFICATION}`,
  },
  icons: {
    icon: `/icons/favicon-32x32.png`,
    shortcut: `/icons/favicon.ico`,
    apple: `/icons/apple-touch-icon.png`,
  },
};
```

ì´ëŠ” ë²„ì „ ì—… ê³¼ì •ì—ì„œ í¬ê²Œ ê±´ë“œë¦¬ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ë¬¸ì œì˜ ì›ì¸ì´ ë  í™•ë¥ ì€ í¬ë°•í–ˆë‹¤.

### ì´ˆê¸° html íŒŒì¼ ë¶„ì„

ì™¸ë¶€ì—ì„œ open graph ë“±ì„ ë°›ì•„ì˜¤ëŠ” ë°©ë²•ì€ ì–´ì¨Œë“  ë‚´ ë¸”ë¡œê·¸ ì£¼ì†Œë¡œ HTTP GET ìš”ì²­ì„ ë³´ë‚´ì„œ ë°›ì•„ì˜¨ ì´ˆê¸° html íŒŒì¼ì„ ë¶„ì„í•˜ëŠ” ê²ƒì´ë¼ê³  ìƒê°í•´ì„œ, ê°œë°œì ë„êµ¬ì˜ ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ ìµœì´ˆë¡œ ì˜¤ëŠ” html ìš”ì²­ì„ í™•ì¸í•˜ê¸°ë¡œ í•˜ì˜€ë‹¤.

![next 14 ë•Œì˜ head íƒœê·¸ ë‚´ë¶€. ì œëŒ€ë¡œ metadata ê°€ ì ìš©ë˜ì–´ìˆë‹¤.](head-14.png)

![next 15 ë¡œ ë²„ì „ ì—… í›„ì˜ head íƒœê·¸ ë‚´ë¶€. ìˆì–´ì•¼ í•  metadata ë“¤ì´ ë³´ì´ì§€ ì•ŠëŠ”ë‹¤.](head-15.png)

ë¹ ì§„ ê²ƒì€ ë©”íƒ€ë°ì´í„° ë¿ë§Œì´ ì•„ë‹ˆì—ˆë‹¤. ì›ë˜ëŠ” pre-rendered ë˜ì–´ì•¼ í–ˆì„ body íƒœê·¸ ë‚´ì˜ ì—¬ëŸ¬ ì„œë²„ ì»´í¬ë„ŒíŠ¸(SSG)ë“¤ì´ ì „í˜€ ë Œë”ë§ë˜ì§€ ì•Šê³ , ê·¸ê²ƒë“¤ì„ ëŒ€ì‹ í•˜ì—¬ ë§ì€ `<script>` íƒœê·¸ë§Œ ìˆì—ˆë‹¤.

ì¦‰, ë§ˆì¹˜ CSR ê³¼ ê°™ì´ ì‘ë™ë˜ê³  ìˆìŒì„ ì•Œê²Œ ë˜ì—ˆë‹¤.

ë¬¸ì œì ë“¤ì„ ìš”ì•½í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤:

- next.js ì—ì„œ ê¶Œì¥í•˜ëŠ” ë°©ë²•ëŒ€ë¡œ ì •ì˜í•œ open graph ë¥¼ í¬í•¨í•œ metadata ê°€ ì²« html ìš”ì²­ì— ì ìš©ë˜ì§€ ì•ŠìŒ
- body ë‚´ì˜ ì»´í¬ë„ŒíŠ¸ë“¤ì´ ëª¨ë‘ CSR ë¨

## ì›ì¸ê³¼ í•´ê²° (ë‚´ ì½”ë“œ) <IntraContentAnchor name="ë¬¸ì œ-í•´ê²°-ë°©ë²•" />

### ğŸ§¯ê¸‰í•œ ë¶ˆì€ ë„ê³  ë³´ìâ€¦

ì²˜ìŒ ì´ ë¬¸ì œë¥¼ ë°œê²¬í–ˆì„ ë•ŒëŠ” ì›ì¸ì„ ì°¾ê¸° ìœ„í•´ ì—¬ëŸ¬ ìˆ˜ì •í•œ íŒŒì¼ë“¤ì„ ë‹¤ì‹œ ê²€í† í–ˆë‹¤. `next.config.ts`, `tsconfig.json` ê°™ì€ íŒŒì¼ë“¤ ë§ì´ë‹¤. ë¬¼ë¡ , ë‹¨ìˆœíˆ í™•ì¥ìë§Œ ë°”ê¾¸ê±°ë‚˜ ì»´íŒŒì¼ íƒ€ê²Ÿë§Œ ì¶”ê°€ í–ˆì„ ë¿ì´ê¸°ì— ì•„ë¬´ ì†Œë“ì´ ì—†ì—ˆë‹¤.

ê²°êµ­, ë²„ì „ ì—… ë³´ë‹¤ëŠ” ì¼ë‹¨ ë¸”ë¡œê·¸ì˜ SEO ë¥¼ í¬ê²Œ ë°©í•´í•˜ëŠ” ë²„ê·¸ë¥¼ í•´ê²°í•˜ëŠ” ê²ƒì´ ìš°ì„ ì´ì—ˆê¸° ë•Œë¬¸ì— **next.js 14, react 18 ë¡œ ë¡¤ë°±**í•˜ì˜€ë‹¤.

ê±°ì§“ë§ì²˜ëŸ¼ ë¬¸ì œëŠ” í•´ê²°ë˜ì—ˆì§€ë§Œ, ê³„ì† ì›ì¸ì„ ì°¾ê¸° ìœ„í•´ ì—¬ëŸ¬ ì´ìŠˆ, ê³µì‹ ë¬¸ì„œë“¤ì„ ì°¾ì•„ë³´ì•˜ë‹¤. 15.3 ì´ìƒì—ì„œëŠ” Suspense ì™€ ê°™ì´ ì‚¬ìš©í•˜ì˜€ì„ ë•Œ, í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë©”íƒ€ë°ì´í„°ê°€ ì¶”ê°€ë˜ì§€ ì•ŠëŠ” ë²„ê·¸ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤ê³  ì•Œê²Œ ë˜ì—ˆì§€ë§Œ, Suspense ë„, ë©”íƒ€ë°ì´í„°ë¥¼ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì—ì„œ ê´€ë¦¬í•˜ì§€ë„ ì•Šì•˜ê¸° ë•Œë¬¸ì— í° ë„ì›€ì€ ë˜ì§€ ì•Šì•˜ë‹¤. ê·¸ë˜ì„œ ì¼ë‹¨ **ì†ìˆ˜ ë””ë²„ê¹…**ì„ í•´ë³´ê¸°ë¡œ í•˜ì˜€ë‹¤.

### ì–´ì´ì—†ëŠ” ì‹¤ìˆ˜!

ë¬¸ì œë¥¼ ì°¾ê¸° ìœ„í•´ì„œ 15 ë²„ì „ì—ì„œ ë””ë²„ê¹…ì„ ì§„í–‰í•˜ì˜€ë‹¤.

ì¼ë‹¨ body ë‚´ì˜ ì»´í¬ë„ŒíŠ¸ë“¤ì´ ëª¨ë‘ CSR ë˜ëŠ” ë¬¸ì œì™€ë„ ì—°ê´€ì´ ìˆì–´ë³´ì˜€ê¸° ë•Œë¬¸ì—, body ë‚´ì˜ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ë“¤ì„ ì‚´í´ë³´ì•˜ë‹¤.

```tsx
// layout.tsx

// ...

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="ko">
      <head></head>
      <body className="antialiased">
        <QueryProvider>
          <CustomThemeProvider attribute="class">
            <ThemeColorSetter />
            {/*  ... */}
            { children }
          </CustomThemeProvider>
        </QueryProvider>
      </body>
    </html>
  );
}
```

```tsx
// CustomThemeProvider.tsx

'use client';

import { ThemeProvider } from 'next-themes';
import { useEffect, useState } from 'react';

const CustomThemeProvider = ({ children }: { children: React.ReactNode }) => {
  const [isMounted, setIsMounted] = useState(false);

  useEffect(() => {
    setIsMounted(true);
  }, []);

  return (
    <>
      {isMounted && <ThemeProvider attribute="class">{children}</ThemeProvider>}
    </>
  );
};

export default CustomThemeProvider;
```

ê·¸ë¦¬ê³ , `CustomThemeProvider` ë¥¼ ì£¼ì„ì²˜ë¦¬ í•˜ë‹ˆ ë” ì´ìƒ ìœ„ì˜ ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•Šì•˜ë‹¤!

#### body ë‚´ì˜ ì»´í¬ë„ŒíŠ¸ê°€ ì—†ì—ˆë˜ ì´ìœ 

ì´ˆê¸° í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ê°€ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë§ˆìš´íŠ¸ ë˜ê¸° ì´ì „ì—ëŠ” `null` ì„ ë°˜í™˜í•˜ê³ , ë§ˆìš´íŠ¸ ì´í›„ì— `ThemeProvider` ë¡œ ê°ì‹¼ children ì´ ë Œë”ë§ëœë‹¤.

```tsx
// ì„œë²„ ì¸¡
null

// í´ë¼ì´ì–¸íŠ¸ ì¸¡ (ë§ˆìš´íŠ¸ í›„)
<ThemeProvider attribute="class">{children}</ThemeProvider>
```

ë‹¹ì—°íˆ, ì„œë²„ ì¸¡ì—ì„œëŠ” `null` ì„ ë³´ë‚´ê¸° ë•Œë¬¸ì— body ë‚´ì— ì•„ë¬´ê²ƒë„ ì—†ì—ˆë˜ ê²ƒì´ë‹¤. (ì´ë ‡ê²Œ í—ˆë¬´í•  ìˆ˜ê°€!)

ë”°ë¼ì„œ, ë‹¤ìŒê³¼ ê°™ì´ ë§ˆìš´íŠ¸ê°€ ë˜ì§€ ì•Šì•˜ì„ ë•ŒëŠ” ê·¸ëƒ¥ children ì„ ë¦¬í„´í•˜ê²Œ í•˜ë©´ ë¬¸ì œëŠ” í•´ê²°ëœë‹¤. ğŸ˜“ (ì½”ë“œë¦¬ë·°ì˜ í•„ìš”ì„± ë° ì¤‘ìš”ì„±â€¦)

```tsx
if (!isMounted) {
 return children;
}

return (
 <ThemeProvider attribute="class">{children}</ThemeProvider>
);
```

í˜¹ì€, ThemeProvider ì´ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆëŠ” hydration warning ì„ ë§‰ê¸°(ë¬´ì‹œí•˜ê¸°) ìœ„í•´ `suppressHydrationWarning` ì„ ìµœìƒìœ„ html íƒœê·¸ì— ë„£ì–´ì£¼ê³ , ê·¸ëŒ€ë¡œ ì‚¬ìš©í•´ë„ ëœë‹¤.

```tsx
<html lang="ko" suppressHydrationWarning>
  <head></head>
  <body className="antialiased">
    <QueryProvider>
      <ThemeProvider attribute="class">
        <ThemeColorSetter />
        {/*  ... */}
        { children }
      </ThemeProvider>
    </QueryProvider>
  </body>
</html>
```

ì´ë ‡ê²Œ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ë©´ ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

![í”Œë˜ê·¸ on](is-it-done.png)

## ì˜ë¬¸ì 

### ë©”íƒ€ë°ì´í„°ëŠ” ì™œ ì—†ì§€?

í•´ë‹¹ ì½”ë“œëŠ” ì—…ê·¸ë ˆì´ë“œ ê³¼ì •ì—ì„œ ìˆ˜ì •í•˜ì§€ ì•Šì•˜ë‹¤. ê·¸ë ‡ë‹¤ëŠ” ê²ƒì€, next 14 ì—ì„œë„ ë™ì¼í•˜ê²Œ ì˜ëª»ëœ ì½”ë“œë¥¼ ì´ìš©í–ˆë‹¤ëŠ” ê²ƒì¸ë°, ì´ ë•ŒëŠ” ì •ìƒì ìœ¼ë¡œ ë©”íƒ€ë°ì´í„°ê°€ head ë‚´ì— ë“¤ì–´ê°€ ìˆì—ˆë‹¤.

ì‚¬ì‹¤, ìƒê°í•´ë´ë„ body ë‚´ë¶€ê°€ null ì´ë¼ê³  í•´ì„œ head ì— ë“¤ì–´ê°€ì•¼ í•  ë©”íƒ€ë°ì´í„°ê°€ ë“¤ì–´ê°€ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì€ ì¡°ê¸ˆ ì´ìƒí–ˆë‹¤. ì‹¤ì œ ë¸Œë¼ìš°ì €ì˜ ìš”ì†Œ ê²€ì‚¬ íˆ´ì„ ì‚¬ìš©í•´ì„œ ë³´ë©´ ë“¤ì–´ê°€ìˆì§€ë§Œ, ëŒ€ë¶€ë¶„ì˜ ë´‡ì´ë‚˜ open graph scrapper ë“¤[^og-bot]ì—ê²Œ ë³´ì—¬ì§€ëŠ” ì²« html ìš”ì²­ì—ëŠ” í¬í•¨ë˜ì§€ ì•Šì•˜ë‹¤.

[^og-bot]: í›„ìˆ í•˜ê² ì§€ë§Œ streaming bot ì´ë‚˜, ë°°í¬í™˜ê²½ì˜ html-limited bot ë“¤ì—ê²Œ ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ë‹¤.

#### ì¶”ì¸¡) `<meta>` íƒœê·¸ì˜ hoisting?

ì²˜ìŒì— í•œ ì¶”ì¸¡ì´ë‹¤.

react 19 ê°€ ë˜ë©´ì„œ meta íƒœê·¸ë¥¼ ì–´ë””ë“  ë°°ì¹˜í•˜ë”ë¼ë„ ìë™ìœ¼ë¡œ head ë‚´ì— ë„£ì–´ì£¼ëŠ” ê¸°ëŠ¥ì´ ë„ì…ë˜ì—ˆë‹¤. ê¸°ì¡´ì—ëŠ” [react-helmet](https://github.com/nfl/react-helmet) ê³¼ ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ `useEffect` ë“±ìœ¼ë¡œ ë„£ì–´ì£¼ì–´ì•¼ í–ˆì—ˆì§€ë§Œ, ì´ì œëŠ” ìë™ìœ¼ë¡œ head ë¡œ í˜¸ì´ìŠ¤íŒ…í•´ì¤€ë‹¤.  

next.js ë„ ì´ëŸ¬í•œ react ì˜ API ë¥¼ ì‚¬ìš©í•œë‹¤ë©´, ë‹¨ìˆœíˆ body ì— `<meta>` íƒœê·¸ë¥¼ ë„£ê³ , head ë¡œ í˜¸ì´ìŠ¤íŒ…í•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤. ê·¸ëŸ¬ë©´,

1. body ë‚´ì˜ children ì´ null â†’ body ë‚´ì˜ `<meta>` íƒœê·¸ê°€ ë Œë”ë§ë˜ì§€ ì•ŠìŒ â†’ ë©”íƒ€ë°ì´í„°ê°€ head ì— ë“¤ì–´ìˆì§€ ì•Šë‹¤ê°€ (ì²« HTTP ìš”ì²­)
2. ë§ˆìš´íŠ¸ ë˜ë©´ children ì´ ë Œë”ë§ â†’ ê·¸ì œì„œì•¼ `<meta>` íƒœê·¸ê°€ ë Œë”ë§ ë° í˜¸ì´ìŠ¤íŒ… ë¨ â†’ ë©”íƒ€ë°ì´í„°ê°€ head ì— ë“¤ì–´ê° (ë¸Œë¼ìš°ì €ì—ì„œ)

í•˜ì§€ë§Œ, next 15 + react 18 ì¡°í•©ìœ¼ë¡œ í•´ë„ ë™ì¼í•œ ë¬¸ì œê°€ ë°œìƒí–ˆê¸° ë•Œë¬¸ì—, react ì˜ ë¬¸ì œëŠ” ì•„ë‹ˆë¼ëŠ” ê²ƒì„ í™•ì¸í–ˆë‹¤.

#### ì‹¤ì œ ì›ì¸) streaming metadata

ì´ ì˜ë¬¸ì„ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ [next.js ë ˆí¬ discussion](https://github.com/vercel/next.js/discussions/79916) ì— ë¬¼ì–´ë³´ì•˜ë‹¤. ë¹„ìŠ·í•œ ì˜ë¬¸ ë° í˜„ìƒì„ ê²½í—˜í•œ ì‚¬ëŒë“¤ì´ ë§ì•˜ê³ , next.js 15 ì˜ [**streaming metadata**](https://nextjs.org/docs/app/api-reference/functions/generate-metadata#streaming-metadata) ë•Œë¬¸ì´ë¼ëŠ” ê²ƒì„ ì•Œì•˜ë‹¤.

ìš”ì•½í•˜ìë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ë´‡(Googlebot, ë¸Œë¼ìš°ì € ë“±)ì—ê²ŒëŠ” ë©”íƒ€ë°ì´í„°ë¥¼ ìŠ¤íŠ¸ë¦¬ë°í•œë‹¤. (streaming metadata)
- ê·¸ë ‡ì§€ ëª»í•˜ëŠ” ë´‡(Slurp, Twitterbot ë“±)ì—ê²ŒëŠ” ì›ë˜ì²˜ëŸ¼ head ì— ë„£ì–´ì„œ ì¤€ë‹¤. (blocking metadata)
  - ì´ë ‡ê²Œ ì–´ë–¤ ë´‡ì—ê²Œ streaming ì„ í•´ì¤„ ê²ƒì¸ì§€ëŠ” next ì—ì„œ [ë¯¸ë¦¬ ì§€ì •í•´ ë†“ì•˜ê³ ](https://github.com/vercel/next.js/blob/canary/packages/next/src/shared/lib/router/utils/html-bots.ts), ì´ë¥¼ ë³€ê²½í•˜ê¸° ìœ„í•´ì„œëŠ” config ì˜ `htmlLimitedBots` ë¥¼ ì¬ì •ì˜ í•´ì£¼ë©´ ëœë‹¤.

        <Note title="ì£¼ì˜" variant="warning">
          `htmlLimitedBots` ë¡œ ì¬ì •ì˜ í•˜ë©´ ê¸°ì¡´ì˜ ì •ì˜ëœ ë´‡ë“¤ì´ ë®ì–´ì”Œì›Œì§„ë‹¤.
        </Note>

ì´ëŠ” ì‚¬ìš©ìë“¤ì—ê²Œ ë”ìš± ë¹ ë¥¸ ë Œë”ë§ëœ í˜ì´ì§€ë¥¼ ì œê³µí•˜ê¸° ìœ„í•¨ìœ¼ë¡œ, ì›ë˜ëŠ” `generateMetadata` ë“±ì˜ í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ë©´ ë©”íƒ€ë°ì´í„°ê°€ ë‹¤ ë§Œë“¤ì–´ì§ˆ ë•Œ ê¹Œì§€ ë Œë”ë§ì„ ë§‰ì•˜ë‹¤(blocked). ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ í•´ì„í•  ìˆ˜ ìˆëŠ” í´ë¼ì´ì–¸íŠ¸ì— ëŒ€í•´ì„œëŠ” ì¼ë‹¨ í˜ì´ì§€ë¥¼ ë Œë”ë§ í•˜ê³ , ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë©”íƒ€ë°ì´í„°ë¥¼ ìŠ¤íŠ¸ë¦¬ë°í•´ì„œ ì•Œì•„ì„œ íŒŒì‹±í•˜ë„ë¡ í•˜ëŠ” ê²ƒì´ ë” ì¢‹ìœ¼ë¯€ë¡œ ì´ëŸ¬í•œ ë°©ì‹ì„ ì±„íƒí•œ ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤.

ê·¸ë˜ì„œ ì •ìƒì ì¸ í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸ë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ì„œ, Slurp ì—ì´ì „íŠ¸[^slurp]ë¥¼ ì´ìš©í•´ì„œ ìš”ì²­í•´ë³´ë‹ˆ, ë©”íƒ€ë°ì´í„°ê°€ head ë‚´ì— ì˜ ë“¤ì–´ê°€ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

[^slurp]: ëŒ€í‘œì ì¸ html-limited bot. Yahoo! ì˜ í¬ë¡¤ë§ ë´‡ì´ë‹¤.

```bash
curl -A "Slurp" http://localhost:3000 | npx prettier --parser html
```

```html
<head>
--
  <title>Create Next App</title>
  <meta name="description" content="Generated by create next app" />
--
</head>
```

ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì½ì„ ìˆ˜ ìˆëŠ” ë´‡ìœ¼ë¡œ ë™ì¼í•œ ìš”ì²­ì„ ë³´ë‚´ë©´, body ë‚´ì— ë©”íƒ€ë°ì´í„°ê°€ ë“¤ì–´ê°€ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆê³  (ì´ë¯¸ ìŠ¤íŠ¸ë¦¬ë° ëœ ë©”íƒ€ë°ì´í„°ë¥¼ body ì— ë„£ì€ ê²ƒìœ¼ë¡œ ë³´ì„), ì´ëŸ¬í•œ ë´‡ë“¤ì€ ì´ë¥¼ í•´ì„í•´ì„œ ë©”íƒ€ë°ì´í„°ë¥¼ ì¸ì‹í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤.

```bash
curl -A "Googlebot" http://localhost:3000 | npx prettier --parser html
```

```html
<head>
--
</head>
<body>
--
  <title>Create Next App</title>
  <meta name="description" content="Generated by create next app" />
--
<body>
```

### ê·¸ë˜ì„œ body ì˜ children ì´ null ì¸ ê²½ìš°ì—ëŠ”?

í•˜ì§€ë§Œ ê²°êµ­ body ë‚´ì— children ì´ ì—†ìœ¼ë©´, body ë‚´ì— `<meta>` ëŒ€ì‹  `<script>` íƒœê·¸ë“¤ë§Œ ìˆëŠ” ê²ƒìœ¼ë¡œ ë³´ì•„, ì œëŒ€ë¡œ streaming metadata ë¥¼ ì²˜ë¦¬í•˜ì§€ ëª»í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤.

ë¬¼ë¡ , ì´ëŸ° ìƒí™©ì´ ê±°ì˜ ë°œìƒí•˜ì§€ ì•ŠëŠ” errorful í•œ ìƒí™©ì¼ìˆ˜ë„ ìˆìœ¼ë‚˜ ì˜ë„ëœ ê²ƒì¸ì§€ í™•ì¸ì´ í•„ìš”í•  ê²ƒ ê°™ë‹¤.

ë”°ë¼ì„œ ì–´ëŠ ìƒí™©ì— ì´ë ‡ê²Œ ë©”íƒ€ë°ì´í„°ê°€ ë Œë”ë§ ë˜ì§€ ì•ŠëŠ”ì§€ íŒŒì•…í•˜ê¸° ìœ„í•˜ì—¬, agent, `{ children }` ì˜ ìœ ë¬´, dev ì¸ì§€ prod ì¸ì§€ë¥¼ ë³€í™”ì‹œì¼œ ì‹¤í—˜í•´ë³´ì•˜ë‹¤.

ì‚¬ìš©í•œ agent ëŠ” streaming bot(`googlebot`), html-limited bot(`facebookexternalhit`) ì´ë‹¤.

<Note variant="default" title="êµ¬ì²´ì ì¸ ì‹¤í—˜ ê²°ê³¼" collapse>
##### WithÂ `{ children }`

1. streaming bots(`Googlebot`)

- Dev: Metadata is in head for first compile, in body for the rest.
- Prod: Metadata is in head.

```html
<head>
  <title>Create Next App</title>
        'body link[rel="icon"], body link[rel="apple-touch-icon"]',
      .forEach((el) => document.head.appendChild(el));
</head>
<body>
      't.suspense"\n29:I["[project]/node_modules/next/dist/client/components/metadata/async-metadata.js [app-client] (ecmascript)",["/_next/static/chunks/node_modules_next_dist_1a6ee436._.js","/_next/static/chunks/src_app_favicon_ico_mjs_8a7a8fdc._.js"],"AsyncMetadata"]\n:HL["/_next/static/chunks/%5Broot-of-the-server%5D__8ebb6d4b._.css","style"]\n:HL["/_next/static/media/gyByhwUxId8gMEwcGFWNOITd-s.p.da1ebef7.woff2","font",{"crossOrigin":"","type":"font/woff2"}]\n:HL["/_next/static/media/or3nQ6H_1_WfwkMZI_qYFrcdmhHkjko-s.p.be19f591.woff2","font",{"crossOrigin":"","type":"font/woff2"}]\n2:{"name":"Preloads","env":"Server","key":null,"owner":null,"stack":[],"props":{"preloadCallbacks":["$E(()=\u003e{ctx.componentMod.preloadStyle(fullHref,ctx.renderOpts.crossOrigin,ctx.nonce)})","$E(()=\u003e{ctx.componentMod.preloadFont(href,type,ctx.renderOpts.crossOrigin,ctx.nonce)})","$E(()=\u003e{ctx.componentMod.preloadFont(href,type,ctx.renderOpts.crossOrigin,ctx.nonce)})"]}}\n1:D"$2"\n1:null\n7:{"name":"RootLayout","env":"Server","key":null,"owner":null,"stack":[],"props":{"children":["$","$L5",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$3",null,{"children":["$","$L6",null,{},null,[],1]},null,[],0],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$Y","forbidden":"$undefined","unauthorized":"$undefined"},null,[],1],"params":"$Y"}}\n4:D"$7"\n9:{"name":"NotFound","env":"Server","key":null,"owner":null,"stack":[],"props":{}}\n8:D"$9"\na:{"name":"HTTPAccessErrorFallback","env":"Server","key":null,"owner":"$9","stack":[],"props":{"status":404,"message":"This page could not be found."}}\n8:D"$a"\n8:[["$","title",null,{"children":"404: This page could not be found."},"$a",[],1],["$","div",null,{"style":{"fontFamily":"system-ui,\\"Segoe UI\\",Roboto,Helvetica,Arial,sans-serif,\\"Apple Color Emoji\\",\\"Segoe UI Emoji\\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","d',
      'iv",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}},"$a",[],1],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404},"$a",[],1],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."},"$a",[],1]},"$a",[],1]]},"$a",[],1]},"$a",[],1]]\n4:["$","html",null,{"lang":"en","children":["$","body",null,{"className":"geist_e531dabc-module__QGiZLq__variable geist_mono_68a01160-module__YLcDdW__variable antialiased","children":["$","$L5",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{},null,[],1],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$8",[]],"forbidden":"$undefined","unauthorized":"$undefined"},null,[],1]},"$7",[["RootLayout","/home/monognuisy/Code/test/sample-test/.next/server/chunks/ssr/[root-of-the-server]__6302eb5e._.js",88,270]],1]},"$7",[["RootLayout","/home/monognuisy/Code/test/sample-test/.next/server/chunks/ssr/[root-of-the-server]__6302eb5e._.js",86,263]],1]\nc:{"name":"Home","env":"Server","key":null,"owner":null,"stack":[],"props":{"params":"$@","searchParams":"$@"}}\nb:D"$c"\n',
      '2a:{"metadata":[["$","title","0",{"children":"Create Next App"},"$13",[],0],["$","meta","1",{"name":"description","content":"Generated by create next app"},"$13",[],0],["$","link","2",{"rel":"icon","href":"/favicon.ico?favicon.45db1c09.ico","sizes":"256x256","type":"image/x-icon"},"$13",[],0]],"error":null,"digest":"$undefined"}\n1c:{"metadata":"$2a:metadata","error":null,"digest":"$undefined"}\n',
</body>
```

```html
<head>
</head>
<body>
      't.suspense"\n29:I["[project]/node_modules/next/dist/client/components/metadata/async-metadata.js [app-client] (ecmascript)",["/_next/static/chunks/node_modules_next_dist_1a6ee436._.js","/_next/static/chunks/src_app_favicon_ico_mjs_8a7a8fdc._.js"],"AsyncMetadata"]\n:HL["/_next/static/chunks/%5Broot-of-the-server%5D__8ebb6d4b._.css","style"]\n:HL["/_next/static/media/gyByhwUxId8gMEwcGFWNOITd-s.p.da1ebef7.woff2","font",{"crossOrigin":"","type":"font/woff2"}]\n:HL["/_next/static/media/or3nQ6H_1_WfwkMZI_qYFrcdmhHkjko-s.p.be19f591.woff2","font",{"crossOrigin":"","type":"font/woff2"}]\n2:{"name":"Preloads","env":"Server","key":null,"owner":null,"stack":[],"props":{"preloadCallbacks":["$E(()=\u003e{ctx.componentMod.preloadStyle(fullHref,ctx.renderOpts.crossOrigin,ctx.nonce)})","$E(()=\u003e{ctx.componentMod.preloadFont(href,type,ctx.renderOpts.crossOrigin,ctx.nonce)})","$E(()=\u003e{ctx.componentMod.preloadFont(href,type,ctx.renderOpts.crossOrigin,ctx.nonce)})"]}}\n1:D"$2"\n1:null\n7:{"name":"RootLayout","env":"Server","key":null,"owner":null,"stack":[],"props":{"children":["$","$L5",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$3",null,{"children":["$","$L6",null,{},null,[],1]},null,[],0],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$Y","forbidden":"$undefined","unauthorized":"$undefined"},null,[],1],"params":"$Y"}}\n4:D"$7"\n9:{"name":"NotFound","env":"Server","key":null,"owner":null,"stack":[],"props":{}}\n8:D"$9"\na:{"name":"HTTPAccessErrorFallback","env":"Server","key":null,"owner":"$9","stack":[],"props":{"status":404,"message":"This page could not be found."}}\n8:D"$a"\n8:[["$","title",null,{"children":"404: This page could not be found."},"$a",[],1],["$","div",null,{"style":{"fontFamily":"system-ui,\\"Segoe UI\\",Roboto,Helvetica,Arial,sans-serif,\\"Apple Color Emoji\\",\\"Segoe UI Emoji\\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","d',
      'iv",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}},"$a",[],1],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404},"$a",[],1],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."},"$a",[],1]},"$a",[],1]]},"$a",[],1]},"$a",[],1]]\n4:["$","html",null,{"lang":"en","children":["$","body",null,{"className":"geist_e531dabc-module__QGiZLq__variable geist_mono_68a01160-module__YLcDdW__variable antialiased","children":["$","$L5",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{},null,[],1],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$8",[]],"forbidden":"$undefined","unauthorized":"$undefined"},null,[],1]},"$7",[["RootLayout","/home/monognuisy/Code/test/sample-test/.next/server/chunks/ssr/[root-of-the-server]__6302eb5e._.js",88,270]],1]},"$7",[["RootLayout","/home/monognuisy/Code/test/sample-test/.next/server/chunks/ssr/[root-of-the-server]__6302eb5e._.js",86,263]],1]\nc:{"name":"Home","env":"Server","key":null,"owner":null,"stack":[],"props":{"params":"$@","searchParams":"$@"}}\nb:D"$c"\n',
      '2a:{"metadata":[["$","title","0",{"children":"Create Next App"},"$13",[],0],["$","meta","1",{"name":"description","content":"Generated by create next app"},"$13",[],0],["$","link","2",{"rel":"icon","href":"/favicon.ico?favicon.45db1c09.ico","sizes":"256x256","type":"image/x-icon"},"$13",[],0]],"error":null,"digest":"$undefined"}\n1c:{"metadata":"$2a:metadata","error":null,"digest":"$undefined"}\n',
  <title>Create Next App</title
        'body link[rel="icon"], body link[rel="apple-touch-icon"]',
      .forEach((el) => document.head.appendChild(el));
</body>
```

2. html-limited bots(`facebookexternalhit`)

- Dev: Metadata is in head
- Prod: Metadata is in head

```html
<head>
  <title>Create Next App</title>
</head>
<body>
      '2","font",{"crossOrigin":"","type":"font/woff2"}]\n2:{"name":"Preloads","env":"Server","key":null,"owner":null,"stack":[],"props":{"preloadCallbacks":["$E(()=\u003e{ctx.componentMod.preloadStyle(fullHref,ctx.renderOpts.crossOrigin,ctx.nonce)})","$E(()=\u003e{ctx.componentMod.preloadFont(href,type,ctx.renderOpts.crossOrigin,ctx.nonce)})","$E(()=\u003e{ctx.componentMod.preloadFont(href,type,ctx.renderOpts.crossOrigin,ctx.nonce)})"]}}\n1:D"$2"\n1:null\n7:{"name":"RootLayout","env":"Server","key":null,"owner":null,"stack":[],"props":{"children":["$","$L5",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$3",null,{"children":["$","$L6",null,{},null,[],1]},null,[],0],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$Y","forbidden":"$undefined","unauthorized":"$undefined"},null,[],1],"params":"$Y"}}\n4:D"$7"\n9:{"name":"NotFound","env":"Server","key":null,"owner":null,"stack":[],"props":{}}\n8:D"$9"\na:{"name":"HTTPAccessErrorFallback","env":"Server","key":null,"owner":"$9","stack":[],"props":{"status":404,"message":"This page could not be found."}}\n8:D"$a"\n8:[["$","title",null,{"children":"404: This page could not be found."},"$a",[],1],["$","div",null,{"style":{"fontFamily":"system-ui,\\"Segoe UI\\",Roboto,Helvetica,Arial,sans-serif,\\"Apple Color Emoji\\",\\"Segoe UI Emoji\\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}},"$a",[],1],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404},"$a"',
      ',[],1],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."},"$a",[],1]},"$a",[],1]]},"$a",[],1]},"$a",[],1]]\n4:["$","html",null,{"lang":"en","children":["$","body",null,{"className":"geist_e531dabc-module__QGiZLq__variable geist_mono_68a01160-module__YLcDdW__variable antialiased","children":["$","$L5",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{},null,[],1],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$8",[]],"forbidden":"$undefined","unauthorized":"$undefined"},null,[],1]},"$7",[["RootLayout","/home/monognuisy/Code/test/sample-test/.next/server/chunks/ssr/[root-of-the-server]__6302eb5e._.js",88,270]],1]},"$7",[["RootLayout","/home/monognuisy/Code/test/sample-test/.next/server/chunks/ssr/[root-of-the-server]__6302eb5e._.js",86,263]],1]\nc:{"name":"Home","env":"Server","key":null,"owner":null,"stack":[],"props":{"params":"$@","searchParams":"$@"}}\nb:D"$c"\n',
      '11:null\n20:[["$","title","0",{"children":"Create Next App"},"$12",[],0],["$","meta","1",{"name":"description","content":"Generated by create next app"},"$12",[],0],["$","link","2",{"rel":"icon","href":"/favicon.ico?favicon.45db1c09.ico","sizes":"256x256","type":"image/x-icon"},"$12",[],0]]\n',
</body>
```

##### WithoutÂ `{ children }`

1. streaming bots(`Googlebot`)

- Dev:Â **No metadata tag.**
- Prod:Â **No metadata tag.**

```html
<head>
</head>
<body class="__variable_5cfdac __variable_9a8899 antialiased">
      '0:{"P":null,"b":"cw34v8qy86IR3ZX4RO89d","p":"","c":["",""],"i":false,"f":[[["",{"children":["__PAGE__",{}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/f5851670bcc5d7e2.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","children":["$","body",null,{"className":"__variable_5cfdac __variable_9a8899 antialiased"}]}]]}],{"children":["__PAGE__",["$","$1","c",{"children":[["$","div",null,{"className":"grid grid-rows-[20px_1fr_20px] items-center justify-items-center min-h-screen p-8 pb-20 gap-16 sm:p-20 font-[family-name:var(--font-geist-sans)]","children":[["$","main",null,{"className":"flex flex-col gap-[32px] row-start-2 items-center sm:items-start","children":[["$","$L2",null,{"className":"dark:invert","src":"/next.svg","alt":"Next.js logo","width":180,"height":38,"priority":true}],["$","ol",null,{"className":"list-inside list-decimal text-sm/6 text-center sm:text-left font-[family-name:var(--font-geist-mono)]","children":[["$","li",null,{"className":"mb-2 tracking-[-.01em]","children":["Get started by editing"," ",["$","code",null,{"className":"bg-black/[.05] dark:bg-white/[.06] px-1 py-0.5 rounded font-[family-name:var(--font-geist-mono)] font-semibold","children":"src/app/page.tsx"}],"."]}],["$","li",null,{"className":"tracking-[-.01em]","children":"Save and see your changes instantly."}]]}],["$","div",null,{"className":"flex gap-4 items-center flex-col sm:flex-row","children":[["$","a",null,{"className":"rounded-full border border-solid border-transparent transition-colors flex items-center justify-center bg-foreground text-background gap-2 hover:bg-[#383838] dark:hover:bg-[#ccc] font-medium text-sm sm:text-base h-10 sm:h-12 px-4 sm:px-5 sm:w-auto","href":"https://vercel.com/new?utm_source=create-next-app\u0026utm_medium=appdir-template-tw\u0026utm_campaign=create-next-app","target":"_blank","rel":"noopener noreferrer","children":[["$","$L2",null,{"className":"dark:invert","src":"/vercel.svg","alt":"Vercel logomark","width":20,"height":20}],"Deploy now"]}],["$","a",null,{"className":"rounded-full border border-solid border-black/[.08] dark:border-white/[.145] transition-colors flex items-center justify-center hover:bg-[#f2f2f2] dark:hover:bg-[#1a1a1a] hover:border-transparent font-medium text-sm sm:text-base h-10 sm:h-12 px-4 sm:px-5 w-full sm:w-auto md:w-[158px]","href":"https://nextjs.org/docs?utm_source=create-next-app\u0026utm_medium=appdir-template-tw\u0026utm_campaign=create-next-app","target":"_blank","rel":"noopener noreferrer","children":"Read our docs"}]]}]]}],["$","footer",null,{"className":"row-start-3 flex gap-[24px] flex-wrap items-center justify-center","children":[["$","a",null,{"className":"flex items-center gap-2 hover:underline hover:underline-offset-4","href":"https://nextjs.org/learn?utm_source=create-next-app\u0026utm_medium=appdir-template-tw\u0026utm_campaign=create-next-app","target":"_blank","rel":"noopener noreferrer","children":[["$","$L2",null,{"aria-hidden":true,"src":"/file.svg","alt":"File icon","width":16,"height":16}],"Learn"]}],["$","a",null,{"className":"flex items-center gap-2 hover:underline hover:underline-offset-4","href":"https://vercel.com/templates?framework=next.js\u0026utm_source=create-next-app\u0026utm_medium=appdir-template-tw\u0026utm_campaign=create-next-app","target":"_blank","rel":"noopener noreferrer","children":[["$","$L2",null,{"aria-hidden":true,"src":"/window.svg","alt":"Window icon","width":16,"height":16}],"Examples"]}],["$","a",null,{"className":"flex items-center gap-2 hover:underline hover:underline-offset-4","href":"https://nextjs.org?utm_source=create-next-app\u0026utm_medium=appdir-template-tw\u0026utm_campaign=create-next-app","target":"_blank","rel":"noopener noreferrer","children":[["$","$L2",null,{"aria-hidden":true,"src":"/globe.svg","alt":"Globe icon","width":16,"height":16}],"Go to nextjs.org â†’"]}]]}]]}],["$","$L3",null,{"children":"$L4"}],null,["$","$L5",null,{"children":["$L6","$L7",["$","$L8",null,{"promise":"$@9"}]]}]]}],{},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","PzboKGdl_5RZ4DJ_JKnkI",{"children":[["$","$La",null,{"children":"$Lb"}],["$","meta",null,{"name":"next-size-adjust","content":""}]]}],null]}],false]],"m":"$undefined","G":["$c","$undefined"],"s":false,"S":true}\n',
      'f:{"metadata":[["$","title","0",{"children":"Create Next App"}],["$","meta","1",{"name":"description","content":"Generated by create next app"}],["$","link","2",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"16x16"}]],"error":null,"digest":"$undefined"}\n9:{"metadata":"$f:metadata","error":null,"digest":"$undefined"}\n',
</body>
```

2. html-limited bots(`facebookexternalhit`)

- Dev: Metadata is in head.
- Prod:Â **No metadata tag.**

```html
<head>
  <title>Create Next App</title>
</head>
<body>
      '2","font",{"crossOrigin":"","type":"font/woff2"}]\n2:{"name":"Preloads","env":"Server","key":null,"owner":null,"stack":[],"props":{"preloadCallbacks":["$E(()=\u003e{ctx.componentMod.preloadStyle(fullHref,ctx.renderOpts.crossOrigin,ctx.nonce)})","$E(()=\u003e{ctx.componentMod.preloadFont(href,type,ctx.renderOpts.crossOrigin,ctx.nonce)})","$E(()=\u003e{ctx.componentMod.preloadFont(href,type,ctx.renderOpts.crossOrigin,ctx.nonce)})"]}}\n1:D"$2"\n1:null\n7:{"name":"RootLayout","env":"Server","key":null,"owner":null,"stack":[],"props":{"children":["$","$L5",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$3",null,{"children":["$","$L6",null,{},null,[],1]},null,[],0],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$Y","forbidden":"$undefined","unauthorized":"$undefined"},null,[],1],"params":"$Y"}}\n4:D"$7"\n4:["$","html",null,{"lang":"en","children":["$","body",null,{"className":"geist_e531dabc-module__QGiZLq__variable geist_mono_68a01160-module__YLcDdW__variable antialiased"},"$7",[["RootLayout","/home/monognuisy/Code/test/sample-test/.next/server/chunks/ssr/[root-of-the-server]__6302eb5e._.js",88,270]],1]},"$7",[["RootLayout","/home/monognuisy/Code/test/sample-test/.next/server/chunks/ssr/[root-of-the-server]__6302eb5e._.js",86,263]],1]\n9:{"name":"Home","env":"Server","key":null,"owner":null,"stack":[],"props":{"params":"$@","searchParams":"$@"}}\n8:D"$9"\n',
      'e:null\n1d:[["$","title","0",{"children":"Create Next App"},"$f",[],0],["$","meta","1",{"name":"description","content":"Generated by create next app"},"$f",[],0],["$","link","2",{"rel":"icon","href":"/favicon.ico?favicon.45db1c09.ico","sizes":"256x256","type":"image/x-icon"},"$f",[],0]]\n',
</body>
```

```html
<head>
</head>
<body class="__variable_5cfdac __variable_9a8899 antialiased">
      '0:{"P":null,"b":"cw34v8qy86IR3ZX4RO89d","p":"","c":["",""],"i":false,"f":[[["",{"children":["__PAGE__",{}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/f5851670bcc5d7e2.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","children":["$","body",null,{"className":"__variable_5cfdac __variable_9a8899 antialiased"}]}]]}],{"children":["__PAGE__",["$","$1","c",{"children":[["$","div",null,{"className":"grid grid-rows-[20px_1fr_20px] items-center justify-items-center min-h-screen p-8 pb-20 gap-16 sm:p-20 font-[family-name:var(--font-geist-sans)]","children":[["$","main",null,{"className":"flex flex-col gap-[32px] row-start-2 items-center sm:items-start","children":[["$","$L2",null,{"className":"dark:invert","src":"/next.svg","alt":"Next.js logo","width":180,"height":38,"priority":true}],["$","ol",null,{"className":"list-inside list-decimal text-sm/6 text-center sm:text-left font-[family-name:var(--font-geist-mono)]","children":[["$","li",null,{"className":"mb-2 tracking-[-.01em]","children":["Get started by editing"," ",["$","code",null,{"className":"bg-black/[.05] dark:bg-white/[.06] px-1 py-0.5 rounded font-[family-name:var(--font-geist-mono)] font-semibold","children":"src/app/page.tsx"}],"."]}],["$","li",null,{"className":"tracking-[-.01em]","children":"Save and see your changes instantly."}]]}],["$","div",null,{"className":"flex gap-4 items-center flex-col sm:flex-row","children":[["$","a",null,{"className":"rounded-full border border-solid border-transparent transition-colors flex items-center justify-center bg-foreground text-background gap-2 hover:bg-[#383838] dark:hover:bg-[#ccc] font-medium text-sm sm:text-base h-10 sm:h-12 px-4 sm:px-5 sm:w-auto","href":"https://vercel.com/new?utm_source=create-next-app\u0026utm_medium=appdir-template-tw\u0026utm_campaign=create-next-app","target":"_blank","rel":"noopener noreferrer","children":[["$","$L2",null,{"className":"dark:invert","src":"/vercel.svg","alt":"Vercel logomark","width":20,"height":20}],"Deploy now"]}],["$","a",null,{"className":"rounded-full border border-solid border-black/[.08] dark:border-white/[.145] transition-colors flex items-center justify-center hover:bg-[#f2f2f2] dark:hover:bg-[#1a1a1a] hover:border-transparent font-medium text-sm sm:text-base h-10 sm:h-12 px-4 sm:px-5 w-full sm:w-auto md:w-[158px]","href":"https://nextjs.org/docs?utm_source=create-next-app\u0026utm_medium=appdir-template-tw\u0026utm_campaign=create-next-app","target":"_blank","rel":"noopener noreferrer","children":"Read our docs"}]]}]]}],["$","footer",null,{"className":"row-start-3 flex gap-[24px] flex-wrap items-center justify-center","children":[["$","a",null,{"className":"flex items-center gap-2 hover:underline hover:underline-offset-4","href":"https://nextjs.org/learn?utm_source=create-next-app\u0026utm_medium=appdir-template-tw\u0026utm_campaign=create-next-app","target":"_blank","rel":"noopener noreferrer","children":[["$","$L2",null,{"aria-hidden":true,"src":"/file.svg","alt":"File icon","width":16,"height":16}],"Learn"]}],["$","a",null,{"className":"flex items-center gap-2 hover:underline hover:underline-offset-4","href":"https://vercel.com/templates?framework=next.js\u0026utm_source=create-next-app\u0026utm_medium=appdir-template-tw\u0026utm_campaign=create-next-app","target":"_blank","rel":"noopener noreferrer","children":[["$","$L2",null,{"aria-hidden":true,"src":"/window.svg","alt":"Window icon","width":16,"height":16}],"Examples"]}],["$","a",null,{"className":"flex items-center gap-2 hover:underline hover:underline-offset-4","href":"https://nextjs.org?utm_source=create-next-app\u0026utm_medium=appdir-template-tw\u0026utm_campaign=create-next-app","target":"_blank","rel":"noopener noreferrer","children":[["$","$L2",null,{"aria-hidden":true,"src":"/globe.svg","alt":"Globe icon","width":16,"height":16}],"Go to nextjs.org â†’"]}]]}]]}],["$","$L3",null,{"children":"$L4"}],null,["$","$L5",null,{"children":["$L6","$L7",["$","$L8",null,{"promise":"$@9"}]]}]]}],{},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","PzboKGdl_5RZ4DJ_JKnkI",{"children":[["$","$La",null,{"children":"$Lb"}],["$","meta",null,{"name":"next-size-adjust","content":""}]]}],null]}],false]],"m":"$undefined","G":["$c","$undefined"],"s":false,"S":true}\n',
      'f:{"metadata":[["$","title","0",{"children":"Create Next App"}],["$","meta","1",{"name":"description","content":"Generated by create next app"}],["$","link","2",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"16x16"}]],"error":null,"digest":"$undefined"}\n9:{"metadata":"$f:metadata","error":null,"digest":"$undefined"}\n',
</body>
```

</Note>

#### ê²°ë¡ 

| children?  | Streaming bot (dev) | Streaming bot (prod) | Html bot (dev) | Html bot (prod) |
| --- | --- | --- | --- | --- |
| O | head or body | head | head | head |
| X | X | X | head | X |

ì—­ì‹œ streaming bot ë“¤ì— ëŒ€í•´ì„œëŠ” children ì´ ì—†ì„ ë•Œ ëª¨ë‘ ë¬¸ì œê°€ ë°œìƒí•œë‹¤. íŠ¹ì´í•œ ì ì€, **html-limited bot ë˜í•œ ë°°í¬í™˜ê²½ì—ì„œëŠ” ë¬¸ì œê°€ ìƒê¸´ë‹¤**ëŠ” ê²ƒì´ë‹¤. ì´ëŠ”, `facebookexternalhit` ë¡œ ê²€ì‚¬í•œ ë‚´ ë¸”ë¡œê·¸ì— open graph íƒœê·¸ë“¤ì´ ë³´ì´ì§€ ì•ŠëŠ” ì´ìœ ì˜€ë‹¤!

ì´ë ‡ê²Œ ì‹¤í—˜ì„ í•œ ë‚´ìš©ë“¤ë„ í¬í•¨í•´ [github issue](https://github.com/vercel/next.js/issues/80547) ì— ì˜¬ë ¸ê³ , ë‹¤í–‰ì´ë¼ê³  í•´ì•¼í• ì§€, **canary ë¹Œë“œì—ì„œëŠ” ì˜ ì‘ë™**í•œë‹¤ëŠ” ë‹µë³€ì„ ë°›ì•˜ë‹¤. í™•ì¸í•´ë³´ë‹ˆ ìµœì‹  canary ë¹Œë“œ ë¿ë§Œ ì•„ë‹ˆë¼, ë¬¸ì œë¥¼ ë°œê²¬í•œ ë‹¹ì‹œë¡œë¶€í„° ì•½ ë‘ ë‹¬ ì „ì¸ `15.3.1-canary.12` ë²„ì „ë¶€í„° ì •ìƒ ì‘ë™í•œë“¯ í–ˆë‹¤.

ë”°ë¼ì„œ, ë³€ê²½ëœ íŒŒì¼ë“¤ì„ ë³´ê³  ì‹¤ì œ ì›ì¸ì„ íŒŒì•…í•´ë³´ê³ ì í•˜ì˜€ë‹¤. ë‹¤í–‰íˆ, ì¤‘ìš”í•œ ë¶€ë¶„ì€ ë‹¨ ëª‡ ì¤„ë°–ì— ìˆ˜ì •ë˜ì§€ ì•Šì•˜ì–´ì„œ ì½”ë“œ ë¦¬ë”©ì´ í¬ê²Œ ì–´ë µì§€ëŠ” ì•Šì•˜ë‹¤.

## next.js ì˜ ì†ŒìŠ¤ì½”ë“œë¥¼ ë¶„ì„í•´ë³´ì! <IntraContentAnchor name="ì›ì¸-ë¶„ì„" />

`ee579bf1..c61b479d` ë¥¼ ë¹„êµí–ˆë‹¤. ë¨¼ì €, ê¸°ì¡´(`c61b479d`) ì½”ë“œì—ì„œ ë°”ë¼ë³¸ ì›ì¸ì„ ì„œìˆ í•˜ê³ , ì´í›„ì— ì´ê²ƒì„ í•´ê²°í•œ ì»¤ë°‹(`ee579bf1`)ì˜ ì½”ë“œë¥¼ ë³´ë„ë¡ í•˜ì.

### ì›ì¸

ì¼ë‹¨, ê°€ì¥ í¬ê²Œ ë°”ë€ ì½”ë“œëŠ” `app-render.tsx`(packages/next/src/server/app-render/app-render.tsx) ì´ë‹¤. ë”°ë¼ì„œ, ì´ íŒŒì¼ì„ ì§‘ì¤‘ì ìœ¼ë¡œ ì‚´í´ë³´ë©´ ì›ì¸ì„ ì°¾ì„ ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.

#### 1. ì™œ `{ children }` ì´ ì—†ìœ¼ë©´ ë©”íƒ€ë°ì´í„°ê°€ ë‚˜ì˜¤ì§€ ì•Šì„ê¹Œ?

##### `createDivergedMetadataComponents` í•¨ìˆ˜

ê¸°ì¡´ì—ëŠ” agent ê°€ streaming bot ì¸ì§€ë¥¼ íŒë³„í•˜ì—¬ ê·¸ì— ë§ëŠ” ë©”íƒ€ë°ì´í„° ì»´í¬ë„ŒíŠ¸ë¥¼ ë°˜í™˜í•˜ëŠ” `createDivergedMetadataComponents` í•¨ìˆ˜ê°€ ìˆì—ˆë‹¤.

```tsx
// packages/next/src/server/app-render/app-render.tsx
// í•¨ìˆ˜ ì •ì˜
function createDivergedMetadataComponents(
  Metadata: React.ComponentType,
  serveStreamingMetadata: boolean
): {
  StaticMetadata: React.ComponentType<{}>
  StreamingMetadata: React.ComponentType<{}> | null
} {
  function EmptyMetadata() {
    return null
  }
  const StreamingMetadata: React.ComponentType | null = serveStreamingMetadata
    ? Metadata
    : null

  const StaticMetadata: React.ComponentType<{}> = serveStreamingMetadata
    ? EmptyMetadata
    : Metadata

  return {
    StaticMetadata,
    StreamingMetadata,
  }
}

// ì‹¤ì œ í˜¸ì¶œ ì˜ˆì‹œ
const { StreamingMetadata, StaticMetadata } =
  createDivergedMetadataComponents(() => {
    return (
      // Adding requestId as react key to make metadata remount for each render
      <MetadataTree key={requestId} />
    )
  }, serveStreamingMetadata)
  
// í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ ì‚¬ìš© ì˜ˆì‹œ
// ëŒ€ë¶€ë¶„ì€ ì´ë ‡ê²Œ StreamingMetadata ì™€ StaticMetadata ë¥¼ ê°™ì´ ì‚¬ìš©í•œë‹¤
<React.Fragment key={flightDataPathHeadKey}>
  {/* noindex needs to be blocking */}
  <NonIndex
    pagePath={ctx.pagePath}
    statusCode={ctx.res.statusCode}
    isPossibleServerAction={ctx.isPossibleServerAction}
  />
  {/* Adding requestId as react key to make metadata remount for each render */}
  <ViewportTree key={requestId} />
  {StreamingMetadata ? <StreamingMetadata /> : null}
  <StaticMetadata />
</React.Fragment>
```

ìŠ¤íŠ¸ë¦¬ë°ì´ ê°€ëŠ¥í•˜ë©´ ë°›ì€ ì»´í¬ë„ŒíŠ¸ë¥¼ `StreamingMetadata` ì—, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ `StaticMetadata` ì— ë„£ëŠ” ë¡œì§ì´ì—ˆë‹¤. ë”°ë¼ì„œ, ëŒ€ë¶€ë¶„ì€ ì´ ë‘˜ì— ëª¨ë‘ ëŒ€ì‘í•  ìˆ˜ ìˆë„ë¡ ë‘ ì»´í¬ë„ŒíŠ¸ë¥¼ ê°™ì´ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

í•˜ì§€ë§Œ, ì´ˆê¸° head ë¥¼ ë§Œë“œëŠ” ë¶€ë¶„ì—ì„œëŠ” `StreamingMetadata` ê°€ ëˆ„ë½ë˜ì–´ìˆë‹¤.

##### head ë Œë”ë§: `getRSCPayload` í•¨ìˆ˜

layout ì˜ head ë¥¼ ë Œë”ë§ í•˜ëŠ” ì½”ë“œì˜ ì¼ë¶€ë¶„ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

```tsx
// packages/next/src/server/app-render/app-render.tsx
async function getRSCPayload(...) {
 // ...
 
  const { StreamingMetadata, StaticMetadata } =
    createDivergedMetadataComponents(() => {
      return (
        // Not add requestId as react key to ensure segment prefetch could result consistently if nothing changed
        <MetadataTree />
      )
    }, serveStreamingMetadata)

 // í•˜ìœ„ react ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ë¥¼ ìƒì„± (page ë‹¨ ë©”íƒ€ë°ì´í„° ì²˜ë¦¬)
  const seedData = await createComponentTree({
    ctx,
    loaderTree: tree,
    parentParams: {},
    injectedCSS,
    injectedJS,
    injectedFontPreloadTags,
    rootLayoutIncluded: false,
    getViewportReady,
    getMetadataReady,
    missingSlots,
    preloadCallbacks,
    authInterrupts: ctx.renderOpts.experimental.authInterrupts,
    StreamingMetadata,
    StreamingMetadataOutlet,
  })
  
  // ...
 
 // ì˜¤ì§ StaticMetadata ë§Œ ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
  const initialHead = (
    <React.Fragment key={flightDataPathHeadKey}>
      <NonIndex
        pagePath={ctx.pagePath}
        statusCode={ctx.res.statusCode}
        isPossibleServerAction={ctx.isPossibleServerAction}
      />
      <ViewportTree key={ctx.requestId} />
      <StaticMetadata />
    </React.Fragment>
  )
  
  // ...
  
  return {
    // See the comment above the `Preloads` component (below) for why this is part of the payload
    P: <Preloads preloadCallbacks={preloadCallbacks} />,
    b: ctx.sharedContext.buildId,
    p: ctx.assetPrefix,
    c: prepareInitialCanonicalUrl(url),
    i: !!couldBeIntercepted,
    f: [
      [
        initialTree,
        seedData,
        initialHead,
        isPossiblyPartialHead,
      ] as FlightDataPath,
    ],
    m: missingSlots,
    G: [GlobalError, globalErrorStyles],
    s: typeof ctx.renderOpts.postponed === 'string',
    S: workStore.isStaticGeneration,
  }
}
```

ì—¬ê¸°ì„œì˜ `initialHead` ì—ëŠ” `StaticMetadata` ë°–ì— ì¡´ì¬í•˜ì§€ ì•Šì•˜ë‹¤. í•˜ì§€ë§Œ, ì–´ë–»ê²Œ ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  ì •ìƒì ì¸ ìƒí™©(children ì´ ìˆëŠ” ê²½ìš°)ì—ëŠ” ë©”íƒ€ë°ì´í„°ê°€ ì˜ ë Œë”ë§ë  ìˆ˜ ìˆì„ê¹Œ?

ì´ë¥¼ íŒŒì•…í•˜ê¸° ìœ„í•´ì„œëŠ” ì € `seedData` ë¥¼ ë§Œë“œëŠ” `createComponentTree` í•¨ìˆ˜ë¥¼ ë“¤ì—¬ë‹¤ë´ì•¼ í•œë‹¤.

##### `createComponentTree` í•¨ìˆ˜

`createComponentTree` í•¨ìˆ˜ëŠ” ë‹¨ìˆœíˆ `createComponentTreeInternal` ì„ í˜¸ì¶œí•˜ëŠ” wrapper í•¨ìˆ˜ì´ë‹¤. ë”°ë¼ì„œ, ë‚´ë¶€ í•¨ìˆ˜ì˜ ì¼ë¶€ë¶„ì„ ë³´ë„ë¡ í•˜ì.

```tsx
// packages/next/src/server/app-render/create-component-tree.tsx

async function createComponentTreeInternal(
 // ...
 ctx,                  // app ë Œë”ë§ ì»¨í…ìŠ¤íŠ¸ (streaming ê°€ëŠ¥ ì—¬ë¶€ í¬í•¨)
 StreamingMetadata,    // createDivergedMetadataComponents í•¨ìˆ˜ë¡œ ìƒì„±ëœ ì»´í¬ë„ŒíŠ¸
 // ...
) {
 // ...
 
 const isPage = typeof page !== 'undefined'
 const metadata = StreamingMetadata ? <StreamingMetadata /> : undefined
 
 if (isPage) {
  return [
      actualSegment,
      <React.Fragment key={cacheNodeKey}>
        {pageElement}
        {/*
         * The order here matters since a parent might call findDOMNode().
         * findDOMNode() will return the first child if multiple children are rendered.
         * But React will hoist metadata into <head> which breaks scroll handling.
         */}
        {metadata}  {/* page ë‹¨ì—ì„œ ë©”íƒ€ë°ì´í„°ë¥¼ ë„£ì–´ì¤€ë‹¤ */}
        {layerAssets}
        <OutletBoundary>
          <MetadataOutlet ready={getViewportReady} />
          {/* Blocking metadata outlet */}
          <MetadataOutlet ready={getMetadataReady} />
          {/* Streaming metadata outlet */}
          {metadataOutlet}
        </OutletBoundary>
      </React.Fragment>,
      parallelRouteCacheNodeSeedData,
      loadingData,
      isPossiblyPartialResponse,
    ]
 } else {
  // layout ì¸ ê²½ìš° íŠ¹ë³„íˆ metadata ì²˜ë¦¬ë¥¼ í•˜ì§€ ì•ŠëŠ”ë‹¤ (ìƒìœ„ í•¨ìˆ˜ì—ì„œ ë‹´ë‹¹)
    return [
      actualSegment,
      segmentNode,
      parallelRouteCacheNodeSeedData,
      loadingData,
      isPossiblyPartialResponse,
    ]
 }
}
```

ì—¬ê¸°ì„œëŠ” page ì¸ ê²½ìš°, ì¸ìë¡œ ë„˜ê²¨ì¤€ `StreamingMetadata` ë¥¼ ë Œë”ë§í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ, children ì´ ìˆìœ¼ë©´ ì–´ì°¨í”¼ page ê°€ ë Œë”ë§ ë  í…Œë‹ˆê¹Œ, ìƒìœ„ í•¨ìˆ˜ (`getRSCPayload`) ì˜ head ì—ì„œ ë©”íƒ€ë°ì´í„°ë¥¼ ë Œë”ë§í•˜ì§€ ì•Šë”ë¼ë„ page ë‚´ë¶€ì—ì„œ ë©”íƒ€ë°ì´í„°ë¥¼ ì²˜ë¦¬í•´ì¤Œìœ¼ë¡œì¨ ì •ìƒì ìœ¼ë¡œ ì‘ë™ë˜ëŠ” ê²ƒì„ì„ ì•Œ ìˆ˜ ìˆë‹¤.

ë™ì‹œì—, ì´ëŠ” children ì´ ì—†ìœ¼ë©´ ë©”íƒ€ë°ì´í„°ê°€ ë Œë”ë§ ë˜ì§€ ì•ŠëŠ” ì´ìœ ì´ê¸°ë„ í•˜ë‹¤!

ì •ë¦¬í•´ë³´ë©´:

| ë´‡ ì¢…ë¥˜ | children? | ë Œë”ë§ ê³¼ì •  | ë©”íƒ€ë°ì´í„° ì—¬ë¶€ |
|--------------------------------|---------------------------|---------------------------|---------------------------|
| Streaming  | O | StaticMetadata ê°€ null -> children ìˆìœ¼ë‹ˆ page ë Œë”ë§ ê°€ëŠ¥ -> page ì—ì„œ StreamingMetadata ì²˜ë¦¬  | O |
| Streaming  | X | StaticMetadata ê°€ null -> children ì—†ìœ¼ë‹ˆ page ë Œë”ë§ ë¶ˆê°€ëŠ¥ -> page ì—ì„œ StreamingMetadata ì²˜ë¦¬ ì•ˆë¨                         | X |
| HTML        | O | StaticMetadata ì‚¬ìš© |  O |
| HTML       | X | StaticMetadata ì‚¬ìš© | O |

#### 2. ì™œ ë°°í¬í™˜ê²½ì—ì„œëŠ” html-limited bot ë„ ë©”íƒ€ë°ì´í„°ë¥¼ ë Œë”ë§í•˜ì§€ ëª»í• ê¹Œ?

í•˜ì§€ë§Œ, ì´ìƒí•œ ì ì€ ë°°í¬ (build í›„ start) í™˜ê²½ì—ì„œëŠ” html bot ë“¤ë„ ì œëŒ€ë¡œ ë©”íƒ€ë°ì´í„°ë¥¼ ë Œë”ë§í•˜ì§€ ëª»í–ˆë‹¤. html bot ì´ë¼ë©´ `serveStreamingMetadata` ê°€ `false` ê°€ ë˜ë©´ì„œ `StaticMetadata` ê°€ ì œëŒ€ë¡œ ë Œë”ë§ë˜ì–´ì•¼ í•˜ëŠ”ë°, ì˜ì™¸ì˜ ê²°ê³¼ì˜€ë‹¤.

í™•ì¸í•œ ê²°ê³¼ ë¹Œë“œí•˜ë©´ `serveStreamingMetadata` ê°€ `true` ê°€ ëœë‹¤. ì´ëŠ” [PR #77434](https://github.com/vercel/next.js/pull/77437) ì— ë”°ë¥´ë©´ ë™ì ì¸ ë©”íƒ€ë°ì´í„°ê°€ ë¹Œë“œ ì‹¤íŒ¨ë˜ì§€ ì•Šê²Œ í•˜ë©´ì„œë„ DIO ê·œì¹™ì„ ì ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ê¸° ë•Œë¬¸ì´ë¼ê³  í•œë‹¤.

```tsx
// packages/next/src/export/worker.ts

async function exportPageImpl(...) {
  const renderOpts: WorkerRenderOpts = {
    ...components,
    ...input.renderOpts,
    ampPath: renderAmpPath,
    params,
    optimizeCss,
    disableOptimizedLoading,
    locale,
    supportsDynamicResponse: false,
    
    // serveStreamingMetadata ë¥¼ true ë¡œ ì„¤ì •
    // During the export phase in next build, we always enable the streaming metadata since if there's
    // any dynamic access in metadata we can determine it in the build phase.
    // If it's static, then it won't affect anything.
    // If it's dynamic, then it can be handled when request hits the route.
    serveStreamingMetadata: true,
    experimental: {
      ...input.renderOpts.experimental,
      isRoutePPREnabled,
    },
  }
}
```

ë”°ë¼ì„œ, html bot ë˜í•œ ë§ˆì¹˜ streaming bot ì²˜ëŸ¼ ì²˜ë¦¬ë˜ì–´ì„œ children ì´ ì—†ëŠ” ê²½ìš° ì œëŒ€ë¡œ `StaticMetadata` ë¥¼ ì²˜ë¦¬í•˜ì§€ ëª»í•˜ëŠ” ê²ƒì´ë‹¤. ë°˜ëŒ€ë¡œ children ì´ ìˆëŠ” ê²½ìš°ì—ëŠ” page ë‹¨ì—ì„œì˜ `StreamingMetadata` ì»´í¬ë„ŒíŠ¸ë¥¼ ì´ìš©í•´ì„œ ë©”íƒ€ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ëœë‹¤.

### í•´ê²°

ì‚¬ì‹¤, ìœ„ ì›ì¸ ë¶€ë¶„ì„ ì½ìœ¼ë©´ì„œ ì¶”ì¸¡í•  ìˆ˜ ìˆì—ˆê² ì§€ë§Œ, `initialHead` ë‚´ì— `StaticMetadata` ë¿ë§Œ ì•„ë‹ˆë¼ `StreamingMetadata` ë¥¼ ë„£ì–´ì£¼ë©´ ë¬¸ì œëŠ” í•´ê²°ëœë‹¤.

ê·¸ë ‡ê²Œ ë˜ë©´ ê²°êµ­ static, streaming ìœ¼ë¡œ ë‚˜ëˆ„ëŠ” ì˜ë¯¸ê°€ ì—†ìœ¼ë¯€ë¡œ (ë‹¤ í•¨ê»˜ ì‚¬ìš©ë˜ë‹ˆê¹Œ) `createDivergedMetadataComponents` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

ë”ìš±ì´, ì´ í•¨ìˆ˜ì˜ ì¸ìë¡œ ê±´ë„¤ì§€ëŠ” `MetadataTree` ì»´í¬ë„ŒíŠ¸ ë‚´ì—ì„œ streaming ê°€ëŠ¥ ì—¬ë¶€ë¥¼ íŒë³„í•˜ëŠ” ë¡œì§ì´ ì´ë¯¸ ìˆë‹¤.

```tsx
// packages/next/src/lib/metadata/metadata.tsx

// MetadataTree ì»´í¬ë„ŒíŠ¸
function MetadataTree() {
  return (
    <MetadataBoundary>
      <Metadata />
    </MetadataBoundary>
  )
}

// Metadata ì»´í¬ë„ŒíŠ¸
async function Metadata() {
  const promise = resolveFinalMetadata()
  
  // ì´ë¯¸ streaming ê°€ëŠ¥ ì—¬ë¶€ ì½”ë“œ ì¡´ì¬
  if (serveStreamingMetadata) {
    return (
      <Suspense fallback={null}>
        <AsyncMetadata promise={promise} />
      </Suspense>
    )
  }
  const metadataState = await promise
  return metadataState.metadata
}
```

ë”°ë¼ì„œ ì´ë¥¼ ìˆ˜ì •í•œ ì»¤ë°‹(`ee579bf1`) ì—ì„œëŠ” `StreamingMetadata` ë‚˜ `StaticMetadata` ëŒ€ì‹  `MetadataTree` ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ ë¬¸ì œë¥¼ í•´ê²°í–ˆë‹¤.

## ê²°ë¡ 

ê²°ë¡ ì ìœ¼ë¡œëŠ”, ë‚˜ì˜ ì‚¬ì†Œí•œ ì‹¤ìˆ˜ ë•Œë¬¸ì— ë°œê²¬í•œ ë¬¸ì œì˜€ê³ , ì½”ë“œ í•˜ë‚˜í•˜ë‚˜ ì§¤ ë•Œë§ˆë‹¤ ìƒê°í•˜ê³  ì§œì•¼í•œë‹¤ëŠ” ê²ƒì„ ë‹¤ì‹œê¸ˆ ê¹¨ë‹«ê²Œ ë˜ì—ˆë‹¤. ê·¸ë˜ë„ ê·¸ ì‘ì€ ì‹¤ìˆ˜ ë•ë¶„ì— next.js, íŠ¹íˆ 15 ë²„ì „ì—ì„œ ë„ì…ëœ streaming metadata ì— ëŒ€í•´ ì˜ ì•Œê²Œ ë˜ì—ˆê³ , ë‚´ë¶€ì ìœ¼ë¡œëŠ” ì–´ë–»ê²Œ êµ¬í˜„ë˜ì–´ìˆëŠ”ì§€ íŒŒì•…í•´ë³¼ ìˆ˜ ìˆì—ˆë‹¤.

ê·¸ë˜ë„ ì•„ì§ê¹Œì§€ëŠ” streaming metadata ê°€ ê³¼ì—° ê·¸ì •ë„ì˜ íš¨ìš©ì„ ë‚´ëŠ”ê°€ ë¼ëŠ” ìƒê°ì„ ë¨¸ë¦¿ì†ì—ì„œ ì§€ìš¸ ìˆ˜ê°€ ì—†ë‹¤. vercel ì´ ì•„ë‹Œ ë‹¤ë¥¸ í”Œë«í¼ì—ì„œëŠ” ì œëŒ€ë¡œ ì‘ë™ì´ ì•ˆëœë‹¤ëŠ” ì´ì•¼ê¸°ë„ ìˆê³ â€¦ ë¬´ì—‡ë³´ë‹¤ ì´ë²ˆì— ì½”ë“œë¥¼ ë³´ë©´ì„œ 14 ë²„ì „ì˜ ì½”ë“œë„ ì‚´í´ë³´ì•˜ëŠ”ë°, ì§€ë‚˜ì¹˜ê²Œ ë©”íƒ€ë°ì´í„° ì²˜ë¦¬ ë¶€ë¶„ì´ ë³µì¡í•´ì§„ ëŠë‚Œì´ ë“¤ì—ˆë‹¤. (ê·¸ë˜ì„œ ì²˜ìŒì— ë¡œì§ íŒŒì•…í•˜ê¸°ê°€ í˜ë“¤ì—ˆë˜â€¦) ë­, ì´ê²ƒì €ê²ƒ ê°œì„ ë˜ë©´ ë” ë‚˜ì•„ì§€ì§€ ì•Šì„ê¹Œ. ê·¸ë ‡ì§€ ì•Šë‹¤ë©´ ë¸”ë¡œê·¸ ê°™ì€ ê°€ë²¼ìš´ ì„œë¹„ìŠ¤ì˜ ê°œë°œì€ ë‹¤ë¥¸ í”„ë ˆì„ì›Œí¬ë¥¼ ê³ ë ¤í•´ë´ì•¼ê² ë‹¤.

ì•„ë¬´ë˜ë„ ì˜¤í”ˆì†ŒìŠ¤ ì½”ë“œëŠ” ë°©ëŒ€í•˜ê¸° ë•Œë¬¸ì— ê·¸ ëª¨ë“  ê²ƒì„ ë‹¤ ì½ì–´ë³´ê³  íŒë‹¨í•˜ëŠ” ê²ƒì´ ì‰½ì§€ ì•Šì•„ cursor ë“±ì˜ AI íˆ´ì˜ ë„ì›€ì„ ë§ì´ ë°›ì•˜ë‹¤. ëª¨ë“  ê²½ìš°ì— ë‹¨ë²ˆì— ì™„ë²½í•˜ê²Œ ë¬¸ì œì ì„ ì°¾ì•„ì£¼ì§€ëŠ” ëª»í–ˆì–´ë„, ê½¤ í° íŒíŠ¸ë“¤ì„ ì¤¬ë‹¤.

ë¬¸ì œì ì„ íŒŒì•…í•˜ê³  ë‚˜ë‹ˆ, ìƒê°ë³´ë‹¤ ê°„ë‹¨í•˜ê²Œ í•´ê²°ë ìˆ˜ë„ ìˆì—ˆë˜ ë¬¸ì œì˜€ë‹¤ëŠ” ì ì´ ì‹ ê¸°í–ˆë‹¤. ì´ë²ˆì—ëŠ” í•´ê²°ëœ ë¬¸ì œë¥¼ ë³¸ ê²ƒì´ì—ˆì§€ë§Œ, ì•ìœ¼ë¡œëŠ” ì´ëŸ¬í•œ ì˜¤í”ˆì†ŒìŠ¤ì— ê¸°ì—¬í•  ìˆ˜ ìˆë„ë¡ ê´€ì‹¬ì„ ê°€ì§€ê³  ì½”ë“œë¥¼ ë´ì•¼ê² ë‹¤ëŠ” ë‹¤ì§ì„ í–ˆë‹¤.

## ì°¸ê³ 

- [Next.js ê³µì‹ ë¬¸ì„œ - Streaming Metadata](https://nextjs.org/docs/app/api-reference/functions/generate-metadata#streaming-metadata)
- [Next.js ê³µì‹ ë¬¸ì„œ - htmlLimitedBots](https://nextjs.org/docs/app/api-reference/config/next-config-js/htmlLimitedBots)
- [vercel/next.js#79916](https://github.com/vercel/next.js/discussions/79916)
- [vercel/next.js#80547](https://github.com/vercel/next.js/issues/80547)
- [vercel/next.js#77434](https://github.com/vercel/next.js/pull/77434)
- [vercel/next.js](https://github.com/vercel/next.js) source code (ee579bf1, c61b479d)
